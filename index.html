<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Upgraded To-Do List App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>
  <!-- Link to CSS -->
    <link rel="stylesheet" href="styles.css">
<body>
  <div class="todo-container">
    <h1>To-Do List</h1>
    <form id="todo-form" autocomplete="off">
      <input type="text" id="todo-input" placeholder="Add a new task..." required>
      <select id="priority-select">
        <option value="Low">Low</option>
        <option value="Medium">Medium</option>
        <option value="High">High</option>
      </select>
      <button type="submit">Add</button>
    </form>
    <div class="filter-bar">
      <button class="filter-btn active" data-filter="all" type="button">All</button>
      <button class="filter-btn" data-filter="active" type="button">Active</button>
      <button class="filter-btn" data-filter="completed" type="button">Completed</button>
    </div>
    <button id="clear-completed-btn" type="button">Clear Completed</button>
    <ul id="todo-list"></ul>
  </div>

  <script>
    // Constants
    const PRIORITIES = ['Low','Medium','High'];
    const STORAGE_KEY = 'todos_v3';

    // Utility Functions
    function getTodos() {
      return JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
    }
    function saveTodos(todos) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(todos));
    }
    function getCurrentFilter() {
      const btn = document.querySelector('.filter-btn.active');
      return btn ? btn.dataset.filter : 'all';
    }

    // Render To-Dos
    function renderTodos(filter = 'all') {
      const todoList = document.getElementById('todo-list');
      todoList.innerHTML = '';
      let todos = getTodos();

      // Filtering
      if (filter === 'active') {
        todos = todos.filter(todo => !todo.completed);
      } else if (filter === 'completed') {
        todos = todos.filter(todo => todo.completed);
      }

      // Render each todo
      todos.forEach((todo, idx) => {
        const li = document.createElement('li');
        li.className = 'todo-item' + (todo.completed ? ' completed' : '');
        if (todo.editing) li.classList.add('todo-editing');

        // Editing mode
        if (todo.editing) {
          const editInput = document.createElement('input');
          editInput.type = 'text';
          editInput.value = todo.text;
          editInput.className = 'edit-input';
          editInput.autofocus = true;

          const editPriority = document.createElement('select');
          editPriority.className = 'edit-priority';
          PRIORITIES.forEach(p => {
            const opt = document.createElement('option');
            opt.value = p;
            opt.innerText = p;
            if (todo.priority === p) opt.selected = true;
            editPriority.appendChild(opt);
          });

          const saveBtn = document.createElement('button');
          saveBtn.className = 'edit-save-btn';
          saveBtn.innerText = 'Save';
          saveBtn.type = 'button';
          saveBtn.onclick = () => saveEdit(idx, editInput.value, editPriority.value);

          const cancelBtn = document.createElement('button');
          cancelBtn.className = 'edit-cancel-btn';
          cancelBtn.innerText = 'Cancel';
          cancelBtn.type = 'button';
          cancelBtn.onclick = () => cancelEdit(idx);

          li.appendChild(editInput);
          li.appendChild(editPriority);
          li.appendChild(saveBtn);
          li.appendChild(cancelBtn);

        } else {
          // Priority badge
          const priorityBadge = document.createElement('span');
          priorityBadge.className = `priority priority-${todo.priority.toLowerCase()}`;
          priorityBadge.textContent = todo.priority || 'Low';

          // Task text
          const span = document.createElement('span');
          span.className = 'todo-text';
          span.textContent = todo.text;
          span.title = "Click to mark as completed";
          span.onclick = () => toggleCompleted(idx);

          // Actions
          const actions = document.createElement('span');
          actions.className = 'todo-actions';

          const editBtn = document.createElement('button');
          editBtn.className = 'edit-btn';
          editBtn.innerText = 'Edit';
          editBtn.type = 'button';
          editBtn.onclick = () => startEdit(idx);

          const deleteBtn = document.createElement('button');
          deleteBtn.className = 'delete-btn';
          deleteBtn.innerText = 'Delete';
          deleteBtn.type = 'button';
          deleteBtn.onclick = () => deleteTodo(idx);

          actions.appendChild(editBtn);
          actions.appendChild(deleteBtn);

          li.appendChild(priorityBadge);
          li.appendChild(span);
          li.appendChild(actions);
        }
        todoList.appendChild(li);
      });
    }

    // Add
    function addTodo(text, priority = 'Low') {
      const todos = getTodos();
      todos.push({ text, completed: false, priority, editing: false });
      saveTodos(todos);
      renderTodos(getCurrentFilter());
    }

    // Delete
    function deleteTodo(index) {
      const todos = getTodos();
      todos.splice(index, 1);
      saveTodos(todos);
      renderTodos(getCurrentFilter());
    }

    // Toggle completed
    function toggleCompleted(index) {
      const todos = getTodos();
      if (!todos[index].editing) {
        todos[index].completed = !todos[index].completed;
        saveTodos(todos);
        renderTodos(getCurrentFilter());
      }
    }

    // Start Edit
    function startEdit(index) {
      const todos = getTodos();
      todos.forEach((t,i) => t.editing = (i === index));
      saveTodos(todos);
      renderTodos(getCurrentFilter());
    }

    // Save Edit
    function saveEdit(index, newText, newPriority) {
      const todos = getTodos();
      if (newText.trim() !== '') {
        todos[index].text = newText.trim();
        todos[index].priority = PRIORITIES.includes(newPriority) ? newPriority : todos[index].priority;
        todos[index].editing = false;
        saveTodos(todos);
        renderTodos(getCurrentFilter());
      }
    }

    // Cancel Edit
    function cancelEdit(index) {
      const todos = getTodos();
      todos[index].editing = false;
      saveTodos(todos);
      renderTodos(getCurrentFilter());
    }

    // Clear completed
    function clearCompleted() {
      let todos = getTodos();
      todos = todos.filter(todo => !todo.completed);
      saveTodos(todos);
      renderTodos(getCurrentFilter());
    }

    // Filter buttons
    function setupFilters() {
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          renderTodos(btn.dataset.filter);
        });
      });
    }

    // Form submit
    document.getElementById('todo-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const input = document.getElementById('todo-input');
      const prioritySelect = document.getElementById('priority-select');
      if (input.value.trim() !== '') {
        addTodo(input.value.trim(), prioritySelect.value);
        input.value = '';
        prioritySelect.value = 'Low';
      }
    });

    // Clear completed click
    document.getElementById('clear-completed-btn').addEventListener('click', clearCompleted);

    // Initial
    window.addEventListener('DOMContentLoaded', () => {
      setupFilters();
      renderTodos();
    });
  </script>
   <!-- Link to JavaScript -->
    <script src="script.js"></script>
</body>
</html>
